name: CI-develop-pr

on:
  pull_request:
    branches:
      - 'Develop'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Install dependencies
        run: npm install
        
      - name: Test
        run: npm run test
        
      - name: Build
        run: npm run build

  auto-merge:
    needs: build
    runs-on: ubuntu-latest
    if: github.event.pull_request.base.ref == 'Develop'
    steps:
      - name: Auto-merge on approval
        uses: pascalgn/automerge-action@v0.15.6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          MERGE_METHOD: "merge"  # 병합 방법 (merge, squash, rebase)
          MERGE_COMMIT_MESSAGE: "pull-request-title"  # 병합 시 커밋 메시지
          MERGE_REQUIRED_APPROVING_REVIEW_COUNT: "3"  # 승인된 리뷰가 3개 이상이어야 병합
